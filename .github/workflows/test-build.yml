name: Newman CLI Sample Run
on:
    workflow_dispatch:

jobs:
    postman_test:
        runs-on: ubuntu-latest
    
        steps:
        - name: Checkout code
          uses: actions/checkout@v2
    
        - name: Install Newman
          run: |
              npm install -g newman
              npm install -g newman-reporter-htmlextra

        - name: Copy File
          run: cp ./postman/chat.csv $GITHUB_WORKSPACE
                  
        - name: Run Postman Collection
          run: newman run "./postman/Virtual Agent.postman_collection.json" -r htmlextra --reporter-htmlextra-export docs/index.html || true

        - name: Add, commit and push changes
          run: |
            git config --local user.email "action@github.com"
            git config --local user.name "GitHub Action"
            git add docs/index.html
            git commit -m "Add generated index.html" -a
            git push https://${{secrets.TEST_SECRET}}@github.com/${{github.repository}}.git HEAD:main
      
        - name: Output the run Details
          uses: actions/upload-artifact@v2
          with:
            name: RunReports
            path: docs
     